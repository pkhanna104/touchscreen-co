#:kivy 1.10.0
#:import Clock kivy.clock.Clock

<Manager>:
    id: screen_manager
    Screen:
        name: 'home'
        BoxLayout
            id: starting
            orientation: 'vertical'

            Label:
                text: ''
                fontsize: 50

            Label:
                text: 'Welcome! Make a Selection in Each Row:'
                fontsize: 80
                color: 0,0,1,1
                canvas.before:
                    Color: 
                        rgb: 1,1,0

            BoxLayout 
                id: top
                orientation: 'horizontal'
                canvas:
                    Color:
                        rgba: 0.1, 0.1, 0.7, 0.5
                    Rectangle:
                        size: self.size
                        pos: self.pos
                Label:
                    text: ''
                    fontsize: 50
                Label: 
                    text: 'Stim : '
                    color: 1, 1, 0, 1

                Label: 
                    text: 'ON'
                CheckBox:
                    group: 'stims'
                    id: stim_on

                Label: 
                    text: 'OFF'
                CheckBox:
                    group: 'stims'
                    id: stim_off
                    active: True
                    
                Label: 
                    text: 'Random'
                CheckBox:
                    group: 'stims'
                    id: stim_rand

                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50

            BoxLayout 
                id: top
                orientation: 'horizontal'
                canvas:
                    Color:
                        rgba: 0, 0, 0, 1
                    Rectangle:
                        size: self.size
                        pos: self.pos
                Label:
                    text: ''
                    fontsize: 50
                Label: 
                    text: 'Reward Setup:        '
                    color: 1, 1, 0, 1

                Label: 
                    text: 'Small rew for CENTER touch\n pls big rew for TARGET touch'
                CheckBox:
                    group: 'rew'
                    id: rew_center_pls_targ_chk
                    active: True
                    
                Label: 
                    text: 'Big rew for TARGET touch'
                CheckBox:
                    group: 'rew'
                    id: rew_targ_chk

                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50


            BoxLayout 
                id: top
                orientation: 'horizontal'
                canvas:
                    Color:
                        rgba: 0.1, 0.1, 0.7, 0.5
                    Rectangle:
                        size: self.size
                        pos: self.pos
                Label:
                    text: ''
                    fontsize: 50
                Label: 
                    text: 'Target Timeout (from first att.)'
                    color: 1, 1, 0, 1

                Label: 
                    text: '15 sec'
                CheckBox:
                    group: 'tt'
                    id: tt_15_sec

                Label: 
                    text: '30 sec'
                CheckBox:
                    group: 'tt'
                    id: tt_30_sec
                    active: True

                Label: 
                    text: '45 sec'
                CheckBox:
                    group: 'tt'
                    id: tt_45_sec

                Label: 
                    text: '60 sec'
                CheckBox:
                    group: 'tt'
                    id: tt_60_sec

                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50

            BoxLayout
                id: starting2
                orientation: 'horizontal'
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: 'Animal Names:'
                    color: 1, 1, 0, 1
                    fontsize: 50
                    
                Label: 
                    text: 'Donut'
                    fontsize: 28
                    halign: 'center'                        
                CheckBox: 
                    group: 'check'
                    id: chk_h
                    active: True

                Label: 
                    text: 'Sandpiper'
                    fontsize: 28
                    halign: 'center'                        
                CheckBox: 
                    group: 'check'
                    id: chk_sand
                
                Label: 
                    text: 'Sabotage'
                    fontsize: 28
                    halign: 'center'                        
                CheckBox: 
                    group: 'check'
                    id: chk_sabo
                   
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50

            BoxLayout 
                id: small_rew
                orientation: 'horizontal'
                canvas:
                    Color:
                        rgba: 0.2, 0.2, 0.5, 0.5
                    Rectangle:
                        size: self.size
                        pos: self.pos
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50
                Label: 
                    text: 'Center Target reward'
                    color: 1, 1, 0, 1

                Label: 
                    text: '0.0 sec'
                CheckBox:
                    id: small_rew_pt0_sec
                    group: 'small_rew'
                    active: True
                    
                Label: 
                    text: '0.1 sec'
                CheckBox:
                    id: small_rew_pt1_sec
                    group: 'small_rew'

                Label: 
                    text: '0.3 sec'
                CheckBox:
                    id: small_rew_pt3_sec
                    group: 'small_rew'

                Label: 
                    text: '0.5 sec'
                CheckBox:
                    id: small_rew_pt5_sec
                    group: 'small_rew'

                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50
            
            BoxLayout 
                id: big_rew
                orientation: 'horizontal'
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50
                Label: 
                    text: 'Periph Target reward'
                    color: 1, 1, 0, 1

                Label: 
                    text: '0.3 sec'
                CheckBox:
                    id: big_rew_pt3_sec
                    group: 'big_rew'
                    active: True

                Label: 
                    text: '0.5 sec'
                CheckBox:
                    id: big_rew_pt5_sec
                    group: 'big_rew'

                Label: 
                    text: '0.7 sec'
                CheckBox:
                    id: big_rew_pt7_sec
                    group: 'big_rew'

                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50

            BoxLayout 
                id: big_rew
                orientation: 'horizontal'
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50
                Label: 
                    text: 'Reward Variability'
                    color: 1, 1, 0, 1

                Label: 
                    text: 'Reward All'
                CheckBox:
                    id: rew_all
                    group: 'rew_var'
                    active: True

                Label: 
                    text: 'Reward 50% '
                CheckBox:
                    id: rew_50
                    group: 'rew_var'

                Label: 
                    text: 'Reward 33% w/ 10% doubled'
                CheckBox:
                    id: rew_30
                    group: 'rew_var'

                Label: 
                    text: 'easy_532'
                CheckBox:
                    id: rew_easy
                    group: 'rew_var'

                Label: 
                    text: 'medium_352'
                CheckBox:
                    id: rew_medium
                    group: 'rew_var'

                Label: 
                    text: 'hard_55'
                CheckBox:
                    id: rew_hard
                    group: 'rew_var'

                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50

            BoxLayout:
                id: params:
                orientation: 'horizontal'
                canvas:
                    Color:
                        rgba: 0.1, 0.1, 0.7, 0.5
                    Rectangle:
                        size: self.size
                        pos: self.pos
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50
                Label: 
                    text: 'Target Radius'
                    color: 1, 1, 0, 1

                Label: 
                    text: '1.0 cm'
                CheckBox:
                    id: targ_rad_10
                    group: 'targ_cm'

                Label: 
                    text: '1.2 cm'
                CheckBox:
                    id: targ_rad_12
                    group: 'targ_cm'

                Label: 
                    text: '1.5 cm'
                CheckBox:
                    id: targ_rad_15
                    group: 'targ_cm'
                    active: True
                                        
                Label:
                    text: ''
                    fontsize: 50

                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50

            BoxLayout:
                id: params:
                orientation: 'horizontal'
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50
                Label: 
                    text: 'CENTER Hold Time'
                    color: 1, 1, 0, 1
                Label:
                    text: ''
                    fontsize: 50

                Label:
                    text: 'Rand: 1.6-2.0'
                    fontsize: 50
                CheckBox:
                    id: chold_16_20
                    group: 'chold_time'

                Label:
                    text: 'Rand: 1.8-2.2'
                    fontsize: 50
                CheckBox:
                    id: chold_18_22
                    group: 'chold_time'

                Label:
                    text: 'Rand: 2.0-2.5'
                    fontsize: 50
                CheckBox:
                    id: chold_20_25
                    group: 'chold_time'

                Label:
                    text: 'Rand: 2.3-2.7'
                    fontsize: 50
                CheckBox:
                    id: chold_23_27
                    group: 'chold_time'
                    active: True

                Label:
                    text: 'Rand: 2.5-3.0'
                    fontsize: 50
                CheckBox:
                    id: chold_25_30
                    group: 'chold_time'

                Label:
                    text: 'Rand: 2.8-3.2'
                    fontsize: 50
                CheckBox:
                    id: chold_28_32
                    group: 'chold_time'

                Label:
                    text: 'Rand: 3.0-3.5'
                    fontsize: 50
                CheckBox:
                    id: chold_30_35
                    group: 'chold_time'

                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50

            BoxLayout:
                id: params:
                orientation: 'horizontal'
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50
                Label: 
                    text: 'Inter-trial interval'
                    color: 1, 1, 0, 1

                Label: 
                    text: 'crazy mode'
                CheckBox:
                    id: iti_10_20
                    group: 'iti'
                    active: True

                Label: 
                    text: 'moderate mode'
                CheckBox:
                    id: iti_15_25
                    group: 'iti'

                Label: 
                    text: 'slow mode'
                CheckBox:
                    id: iti_20_30
                    group: 'iti'

                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50


            BoxLayout:
                id: test
                orientation: 'horizontal'
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50
                Label: 
                    text: 'Auto-Quit After: '
                    color: 1, 1, 0, 1

                Label: 
                    text: '10 trials'
                CheckBox:
                    id: ten_trials
                    group: 'trials'

                Label: 
                    text: '25 trials'
                CheckBox:
                    id: twenty_five_trials
                    group: 'trials'
                    active: True

                Label:
                    text: '50 trials'
                CheckBox:
                    id: fifty_trials
                    group: 'trials'
                    
                Label:
                    text: '100 trials!'
                CheckBox:
                    id: hundred_trials
                    group: 'trials'

                Label:
                    text: 'Dont AutoQuit'
                CheckBox:
                    id: no_trials
                    group: 'trials'

                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50


            Button:
                text: 'Play "Feel the Stim: Phase II" Game'
                halign: 'center'
                valign: 'middle'
                font_size: 50
                text_size: self.size
                on_release: 
                    root.current = 'splash_start'
                    splash.init(
                    dict(stims=[stim_on.active, stim_off.active, stim_rand.active]),

                    dict(donu=chk_h.active, sand=chk_sand.active,sabo=chk_sabo.active), 
                    
                    dict(rew_manual=False, rew_anytouch=False, rew_center_pls_targ=rew_center_pls_targ_chk.active, rew_targ=rew_targ_chk.active, snd_only=False, 
                    small_rew=[small_rew_pt0_sec.active, small_rew_pt1_sec.active, small_rew_pt3_sec.active, small_rew_pt5_sec.active], big_rew=[big_rew_pt3_sec.active, big_rew_pt5_sec.active, big_rew_pt7_sec.active]), 
                    
                    dict(targ_rad=[targ_rad_10.active, targ_rad_12.active, targ_rad_15.active]), 

                    dict(test=[False, True, False]), 

                    dict(chold=[chold_16_20.active, chold_18_22.active, chold_20_25.active, chold_23_27.active, chold_25_30.active, chold_28_32.active, chold_30_35.active]), 

                    dict(iti = [iti_10_20.active, iti_15_25.active, iti_20_30.active]),

                    dict(autoquit=[ten_trials.active, twenty_five_trials.active, fifty_trials.active, hundred_trials.active, no_trials.active]),
                    
                    dict(rew_var=[rew_all.active, rew_50.active, rew_30.active, rew_easy.active, rew_medium.active, rew_hard.active]),
                    
                    dict(tt=[tt_15_sec.active, tt_30_sec.active, tt_45_sec.active, tt_60_sec.active]))


            Label:
                text: ''
                fontsize: 50
            Label:
                text: ''
                fontsize: 50

    Screen: 
        name: 'splash_start'
        Splash:
            id: splash

        BoxLayout:
            id: test
            orientation: 'vertical'
            Label:
                text: 'Parameters Cached!! \n \n Prepare the Monkey! \n \n Pausing Until Start Button Pressed. '
                halign: 'center'
                fontsize: 50
            Label:
                text: ''
                fontsize: 50
            Label:
                text: ''
                fontsize: 50
            Label:
                text: ''
                fontsize: 50
            Label:
                text: ''
                fontsize: 50
               
            BoxLayout:
                id: test2
                orientation: 'horizontal'
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50

                Button: 
                    text: 'Start'
                    color: .25, .25, .25, 1
                    background_color: (.2, .2, .2, 1.0)

                    on_release:
                        root.current = 'game_screen'
                        game.init(*splash.args)
                        Clock.schedule_interval(game.update, 1.0 / 60.0)
                
                Label:
                    text: ''
                    fontsize: 50
                Label:
                    text: ''
                    fontsize: 50

            Label:
                text: ''
                fontsize: 50
                
    Screen:
        name: 'game_screen'
        COGame:
            id: game

<COGame>:
    center_target: target_c
    periph_target1: target_p1
    periph_target1_BE: target_p1_be
    periph_target2: target_p2
    periph_target2_BE: target_p2_be
    exit_target1: target_e1
    exit_target2: target_e2
    indicator_targ: indicator

    Target:
        id: indicator

    Target:
        id: target_c
        
    Target: 
        id: target_p1
    Target: 
        id: target_p1_be

    Target: 
        id: target_p2
    Target: 
        id: target_p2_be

    Target:
        id: target_e1

    Target:
        id: target_e2

    Label:
        color: .5,.5,.5,1
        font_size: 50
        center_x: root.width * 6/8
        top: root.top - 70
        text: str(root.trial_counter)

    Label:
        color: .5,.5,.5,1
        font_size: 50
        center_x: root.width * 2/8
        top: root.top - 170
        text: root.cht_text
    Label:
        color: .5,.5,.5,1
        font_size: 50
        center_x: root.width * 5/8
        top: root.top - 170
        text: root.cht_param

    Label:
        color: .5,.5,.5,1
        font_size: 50
        center_x: root.width * 2/8
        top: root.top - 220
        text: root.tht_text
    Label:
        color: .5,.5,.5,1
        font_size: 50
        center_x: root.width * 5/8
        top: root.top - 220
        text: root.tht_param

    Label:
        color: .5,.5,.5,1
        font_size: 50
        center_x: root.width * 2/8
        top: root.top - 270
        text: root.targ_size_text
    Label:
        color: .5,.5,.5,1
        font_size: 50
        center_x: root.width * 5/8
        top: root.top - 270
        text: root.targ_size_param

    Label:
        color: .5,.5,.5,1
        font_size: 50
        center_x: root.width * 2/8
        top: root.top - 320
        text: root.big_rew_text
    Label:
        color: .5,.5,.5,1
        font_size: 50
        center_x: root.width * 5/8
        top: root.top - 320
        text: root.big_rew_time_param

    Label:
        color: .5,.5,.5,1
        font_size: 50
        center_x: root.width * 2/8
        top: root.top - 570
        text: root.total_counter_text
    Label:
        color: .5,.5,.5,1
        font_size: 50
        center_x: root.width * 5/8
        top: root.top - 570
        text: root.total_counter_param

    Label:
        color: .5,.5,.5,1
        font_size: 50
        center_x: root.width * 2/8
        top: root.top - 620
        text: root.center_error_counter_text
    Label:
        color: .5,.5,.5,1
        font_size: 50
        center_x: root.width * 5/8
        top: root.top - 620
        text: root.center_error_counter_param

    Label:
        color: .5,.5,.5,1
        font_size: 50
        center_x: root.width * 2/8
        top: root.top - 670
        text: root.target_error_counter_text
    Label:
        color: .5,.5,.5,1
        font_size: 50
        center_x: root.width * 5/8
        top: root.top - 670
        text: root.target_error_counter_param


<Target>:
    canvas:
        Color:
            rgba:self.color
        Ellipse: 
            pos:self.pos
            size:self.size